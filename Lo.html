
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Lo</title><style></style></head><body><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Moniter</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .success-message {
            animation: fadeInOut 3s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        .subject-btn {
            transition: all 0.2s ease-in-out;
        }
        .subject-btn:hover {
            transform: scale(1.05);
        }
        .subject-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border-color: #4f46e5;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800 antialiased relative">

    <main class="flex-grow flex items-center justify-center py-8 px-4">
        <div class="max-w-xl w-full mx-auto p-6 bg-white rounded-3xl shadow-xl border border-gray-200 relative">

            <!-- Top-right Profile button -->
            <button id="profile-btn" class="absolute top-4 right-4 p-2 bg-indigo-50 text-indigo-600 rounded-full shadow-md hover:bg-indigo-100 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            </button>

            <!-- Header with app name and colorful icon -->
            <div class="flex flex-col items-center justify-center mb-6 text-center">
                <div class="p-3 bg-blue-100 rounded-full mb-3">
                    <!-- Colorful SVG for a graduation cap icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21.56 12.56L12 7.02l-9.56 5.54L12 18.1zm-1.8-1.04l-7.76-4.5-7.76 4.5 7.76 4.5zM12 2a1 1 0 01.8.4l10 5.75a1 1 0 010 1.7L12.8 15.6a1 1 0 01-1.6 0L1.2 9.85a1 1 0 010-1.7l10-5.75A1 1 0 0112 2zm-1 18a1 1 0 01-1-1v-5.5a1 1 0 012 0v5.5a1 1 0 01-1 1z"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-900">Study Moniter</h1>
                <p class="text-gray-500 text-sm">AI-Powered Assistant</p>
            </div>

            <!-- Main question input section -->
            <div class="mb-6">
                <p class="font-medium text-gray-700 mb-2">Write your question here (optional):</p>
                <textarea id="question" rows="4" placeholder="Example: What is the main cause of tides?"
                    class="w-full p-4 rounded-xl border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors resize-none"></textarea>
            </div>

            <!-- Solution output section -->
            <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200 shadow-inner flex flex-col mb-6">
                <h3 class="text-xl font-bold mb-4">Solution</h3>
                <div id="loading" class="hidden flex items-center justify-center p-4 text-center text-gray-500">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Thinking...
                </div>
                <div id="response" class="flex-grow p-4 bg-white rounded-xl border border-gray-200 overflow-y-auto text-gray-700 leading-relaxed space-y-4 min-h-[150px]">
                    <p class="text-gray-400">Your solution will appear here.</p>
                </div>
                <button id="copy-btn" class="w-full mt-4 p-3 text-white font-semibold bg-gray-500 rounded-xl shadow-lg hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 transition-all duration-300 ease-in-out hidden">
                    <svg class="inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 2a2 2 0 00-2 2v2H4a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2h2a2 2 0 002-2V4a2 2 0 00-2-2H8zm0 2h6a2 2 0 012 2v6H8V4zm-2 4h6v6a2 2 0 01-2 2H6V8z"/></svg>
                    Copy Solution
                </button>
            </div>

            <!-- Solve button -->
            <button id="solve-btn"
                class="w-full flex items-center justify-center gap-2 p-4 mb-6 text-white font-semibold bg-indigo-600 rounded-xl shadow-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-300 transition-all duration-300 ease-in-out">
                <!-- SVG for a paper airplane icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21 3L3 10.5h15l-3 6.5 3 2 6-8.5z"/>
                </svg>
                Solve
            </button>
            
            <p class="text-center text-gray-500 mb-6">- OR -</p>

            <!-- Image upload section (Placeholder) -->
            <div class="drag-area p-8 text-center rounded-2xl border-gray-300 transition-colors cursor-pointer mb-6">
                <input type="file" id="image-upload" accept="image/*" class="hidden">
                <label for="image-upload" class="cursor-pointer">
                    <!-- SVG for a cloud upload icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-2" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.84 8.35 1 10.83 1 13.5c0 3.03 2.47 5.5 5.5 5.5h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
                    </svg>
                    <p class="text-gray-500">Click or drag your image here</p>
                </label>
            </div>

            <!-- Subject selection grid -->
            <div class="mb-6">
                <p class="font-medium text-gray-700 mb-4">Choose a subject:</p>
                <div id="subject-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4">
                    <!-- Subject buttons will be dynamically added here by JS -->
                </div>
            </div>
            
        </div>
    </main>

    <!-- Student Profile Modal (Hidden by default) -->
    <div id="profile-modal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-3xl shadow-xl border border-gray-200 p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-900">Student Profile</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <form id="profile-form" class="space-y-4">
                <div>
                    <label for="student-name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="student-name" class="mt-1 w-full p-2 rounded-xl border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Your Name">
                </div>
                <div>
                    <label for="student-class" class="block text-sm font-medium text-gray-700">Class</label>
                    <select id="student-class" class="mt-1 w-full p-2 rounded-xl border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="">Select Class</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>
                        <option value="12">Class 12</option>
                    </select>
                </div>
                <div>
                    <label for="student-board" class="block text-sm font-medium text-gray-700">Board</label>
                    <select id="student-board" class="mt-1 w-full p-2 rounded-xl border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="">Select Board</option>
                        <option value="CBSE">CBSE</option>
                        <option value="NCERT">NCERT</option>
                        <option value="UP Board">UP Board</option>
                        <option value="Delhi Board">Delhi Board</option>
                        <option value="ICSE">ICSE</option>
                        <option value="State Board">State Board</option>
                    </select>
                </div>
                <div>
                    <label for="answer-language" class="block text-sm font-medium text-gray-700">Answer Language</label>
                    <select id="answer-language" class="mt-1 w-full p-2 rounded-xl border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="English">English</option>
                        <option value="Hindi">Hindi</option>
                        <option value="Bengali">Bengali</option>
                        <option value="Marathi">Marathi</option>
                        <option value="Tamil">Tamil</option>
                        <option value="Telugu">Telugu</option>
                    </select>
                </div>
                <button type="submit"
                    class="w-full flex items-center justify-center gap-2 p-3 text-white font-semibold bg-indigo-600 rounded-xl shadow-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-300 transition-all duration-300 ease-in-out">
                    Save Profile
                </button>
                <p id="profile-saved-message" class="hidden text-center text-green-600 font-medium"></p>
            </form>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-transparent py-4 text-center text-gray-500 text-sm">
        © 2025 Study Moniter | Developed with <span class="text-red-500">❤️</span> by Divyansh - Deewana.
    </footer>

    <script>
        // Get references to all necessary elements
        const profileBtn = document.getElementById('profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const solveBtn = document.getElementById('solve-btn');
        const questionInput = document.getElementById('question');
        const responseDiv = document.getElementById('response');
        const loadingDiv = document.getElementById('loading');
        const copyBtn = document.getElementById('copy-btn');
        const subjectGrid = document.getElementById('subject-grid');
        const profileForm = document.getElementById('profile-form');
        const profileSavedMessage = document.getElementById('profile-saved-message');

        // Subjects and their corresponding SVG icons with custom colors
        const subjects = {
            'General': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#F59E0B"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-6h-2v6zm0-8h2V7h-2v2z"/></svg>',
                color: '#F59E0B' // Yellow
            },
            'Hindi': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#EF4444"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 19V5h14l.01 14H5z"/><path d="M15 8h-2.5c-.28 0-.5.22-.5.5s.22.5.5.5h1c.55 0 1 .45 1 1v1.5c0 .55-.45 1-1 1H11c-.55 0-1-.45-1-1V9c0-.55-.45-1-1-1H7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h2c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1h-1.5c-.55 0-1-.45-1-1V9.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5v1c0 .55.45 1 1 1h2.5c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H11c-.55 0-1-.45-1-1V5.5c0-.28.22-.5.5-.5s.5.22.5.5v2.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h-2c-.55 0-1-.45-1-1V4.5c0-.28.22-.5.5-.5s.5.22.5.5v2c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h2c.55 0 1 .45 1 1V4.5c0-.28.22-.5.5-.5s.5.22.5.5v2c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H15c-.55 0-1-.45-1-1V3.5c0-.28.22-.5.5-.5s.5.22.5.5v2c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h-2c-.55 0-1-.45-1-1V3.5c0-.28.22-.5.5-.5s.5.22.5.5v2c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H15.5c-.55 0-1-.45-1-1V2.5c0-.28.22-.5.5-.5s.5.22.5.5v2c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H16.5c.55 0 1 .45 1 1v1.5c0 .28-.22.5-.5.5h-2.5c-.28 0-.5.22-.5.5s.22.5.5.5h2c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1h-1.5c-.55 0-1-.45-1-1V9.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5v1c0 .55.45 1 1 1h2.5c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1H16z"/></svg>',
                color: '#EF4444' // Red
            },
            'English': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#3B82F6"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.5-12l-2.5 7.5L12 12l-2 5.5-2.5-7.5H12z"/></svg>',
                color: '#3B82F6' // Blue
            },
            'Mathematics': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#10B981"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 19V5h14v14H5zm4-6h2v-2h2v2h2v2h-2v2h-2v-2h-2v-2z"/></svg>',
                color: '#10B981' // Green
            },
            'Physics': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#06B6D4"><path d="M19 12h-2V7h-2V5h-2V3h-2v2h2v2h2v5h2v2h-2v5h-2v2h2v2h2v-2h2v-5h2V12zM5 12V7H3V5h2V3h2v2h2v2H7v5H5z"/></svg>',
                color: '#06B6D4' // Cyan
            },
            'Chemistry': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#8B5CF6"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>',
                color: '#8B5CF6' // Purple
            },
            'Biology': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#EC4899"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-8h2v-2h-2v2zM12 11c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/></svg>',
                color: '#EC4899' // Pink
            },
            'Computer Science': {
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2" viewBox="0 0 24 24" fill="#3B82F6"><path d="M20 18v1c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1v-1c0-.55.45-1 1-1h14c.55 0 1 .45 1 1zM20 5H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 2v11H4V7h16z"/></svg>',
                color: '#3B82F6' // Blue
            },
        };
        
        let selectedSubject = 'General';

        // Dynamically create subject buttons
        for (const [subject, data] of Object.entries(subjects)) {
            const button = document.createElement('button');
            button.className = `subject-btn p-4 flex flex-col items-center justify-center text-center rounded-2xl border border-gray-300 shadow-sm hover:bg-indigo-100 ${subject === selectedSubject ? 'active' : 'bg-white'}`;
            button.innerHTML = `${data.icon}<span>${subject}</span>`;
            button.dataset.subject = subject;

            // Handle button click for subject selection
            button.addEventListener('click', () => {
                // Deselect previous button
                document.querySelector('.subject-btn.active')?.classList.remove('active');
                
                // Select new button
                button.classList.add('active');
                selectedSubject = subject;
            });
            subjectGrid.appendChild(button);
        }
        
        // Function to copy text to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<svg class="inline-block w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M8 2a2 2 0 00-2 2v2H4a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2h2a2 2 0 002-2V4a2 2 0 00-2-2H8zm0 2h6a2 2 0 012 2v6H8V4zm-2 4h6v6a2 2 0 01-2 2H6V8z"/></svg>Copy Solution';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textarea);
        }

        // Show/Hide Modal functionality
        profileBtn.addEventListener('click', () => {
            profileModal.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => {
            profileModal.classList.add('hidden');
        });
        
        // Close modal when clicking outside of it
        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                profileModal.classList.add('hidden');
            }
        });

        // Handle profile form submission
        profileForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const studentName = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;
            const studentBoard = document.getElementById('student-board').value;
            const answerLanguage = document.getElementById('answer-language').value;
            
            // Save data to localStorage
            localStorage.setItem('studentProfile', JSON.stringify({
                name: studentName,
                class: studentClass,
                board: studentBoard,
                language: answerLanguage
            }));
            
            profileSavedMessage.textContent = 'Profile saved successfully!';
            profileSavedMessage.classList.remove('hidden');
            profileSavedMessage.classList.add('success-message');

            setTimeout(() => {
                profileSavedMessage.classList.add('hidden');
                profileSavedMessage.classList.remove('success-message');
                profileModal.classList.add('hidden'); // Close modal after successful save
            }, 3000);
        });

        // Load profile from localStorage on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedProfile = JSON.parse(localStorage.getItem('studentProfile'));
            if (savedProfile) {
                document.getElementById('student-name').value = savedProfile.name || '';
                document.getElementById('student-class').value = savedProfile.class || '';
                document.getElementById('student-board').value = savedProfile.board || '';
                document.getElementById('answer-language').value = savedProfile.language || 'English';
            }
        });

        // Event listener for the "Solve" button
        solveBtn.addEventListener('click', async () => {
            const userQuestion = questionInput.value.trim();
            const savedProfile = JSON.parse(localStorage.getItem('studentProfile'));

            if (!savedProfile || !savedProfile.class || !savedProfile.board) {
                responseDiv.innerHTML = '<p class="text-red-500">Please fill out your student profile (Class and Board are required) and click "Save Profile" before asking a question.</p>';
                copyBtn.classList.add('hidden');
                return;
            }

            if (userQuestion === '') {
                responseDiv.innerHTML = '<p class="text-red-500">Please enter a question to solve.</p>';
                copyBtn.classList.add('hidden');
                return;
            }

            responseDiv.innerHTML = '';
            loadingDiv.classList.remove('hidden');
            copyBtn.classList.add('hidden');
            
            const prompt = `Solve the following problem for a ${savedProfile.class} student from the ${savedProfile.board} board. Provide a concise, direct, and easy-to-understand solution without any greetings or introductory phrases. Respond in ${savedProfile.language}.
            
            Problem: ${userQuestion}`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // API key will be managed by the deployment environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const fetchWithRetry = async (url, options, retries = 3, delay = 1000) => {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            if (response.status === 429 && retries > 0) {
                                console.warn(`API rate limit exceeded. Retrying in ${delay / 1000}s...`);
                                await new Promise(res => setTimeout(res, delay));
                                return fetchWithRetry(url, options, retries - 1, delay * 2);
                            }
                            throw new Error(`API error: ${response.statusText}`);
                        }
                        return response;
                    } catch (error) {
                        if (retries > 0) {
                            console.warn(`Fetch failed: ${error.message}. Retrying in ${delay / 1000}s...`);
                            await new Promise(res => setTimeout(res, delay));
                            return fetchWithRetry(url, options, retries - 1, delay * 2);
                        }
                        throw error;
                    }
                };

                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    const formattedText = text.replace(/\n/g, '<br>');
                    responseDiv.innerHTML = formattedText;
                    
                    copyBtn.classList.remove('hidden');
                    copyBtn.addEventListener('click', () => copyToClipboard(text), { once: true });
                } else {
                    responseDiv.innerHTML = '<p class="text-red-500">Sorry, something went wrong or the response was empty. Please try again.</p>';
                }
            } catch (error) {
                console.error('Error fetching data from Gemini API:', error);
                responseDiv.innerHTML = `<p class="text-red-500">An error occurred: ${error.message}. Please check your connection and try again.</p>`;
            } finally {
                loadingDiv.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
<script></script></body></html>